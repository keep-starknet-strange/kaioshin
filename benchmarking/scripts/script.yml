# Copyright 2021-2022 Dwellir AB authors & contributors
# SPDX-License-Identifier: Apache-2.0

config:
  target: "ws://127.0.0.1:9944"
  processor: "./functions.js"
  phases:
    - duration: 2
      arrivalCount: 1
      name: Users connection
    - pause: 30
      name: Stress test
  variables:
    programId:
    - 0
    # - 1
  engines:
   substrate: {}
scenarios:
  - engine: substrate
    name: headers_blocks
    flow:
      - connect: "{{ target }}"
      - loop:
        - call:
            method: api.rpc.chain.getHeader()
            saveTo: header
        - log: "Current hash: {{ header.hash }}"
        - call:
            method: api.rpc.chain.getBlock({{ header.hash }})
            saveTo: block
        - log: "Current Block Number: {{ block.block.header.number }}"
        count: 2
  - engine: substrate
    name: cairo_program
    flow:
      - loop:
        - function: "runCairoProgram"
        - log: "Cairo program execution done {{ programId }}"
        count: 500

